<app-header></app-header>
<div class="detail-car-container" *ngIf="car">
  <div class="detail-car-breadcrumb">
    Trang ch·ªß &gt; Mua xe &gt; <span class="detail-car-title-breadcrumb">{{ car.model }} {{ car.year
      }} - {{ car.mileage | number }}KM</span>
  </div>
  <div class="detail-car-main">
    <div class="detail-car-left">
      <div class="detail-car-image-main" (click)="openModal(currentImageIndex)">
        <img [src]="car.images?.[currentImageIndex]?.imageUrl || 'https://via.placeholder.com/600x400?text=Car+Main'"
          [alt]="car.model + ' main image'" />
        <button class="slider-btn prev-btn" (click)="prevImage($event)">&lt;</button>
        <button class="slider-btn next-btn" (click)="nextImage($event)">&gt;</button>
        <div class="detail-car-image-count">{{ currentImageIndex + 1 }} / {{ car.images?.length || 1 }}</div>
      </div>

      <div class="detail-car-image-list">
        <img *ngFor="let img of car.images || []; let i = index" [src]="img.imageUrl"
          [alt]="car.model + ' image ' + (i + 1)" [class.active]="i === currentImageIndex" (click)="goToSlide(i)" />
      </div>

      <div class="detail-car-features">
        <div class="detail-car-feature">
          <span class="detail-car-feature-icon">üöó</span>
          ƒê·∫°t ki·ªÉm ƒë·ªãnh ch√≠nh h√£ng
        </div>
        <div class="detail-car-feature">
          <span class="detail-car-feature-icon">üìÑ</span>
          Ph√°p l√Ω an to√†n
        </div>
        <div class="detail-car-feature">
          <span class="detail-car-feature-icon">üíß</span>
          Kh√¥ng ƒë√¢m ƒë·ª•ng, th·ªßy k√≠ch
        </div>
      </div>

      <div class="detail-car-desc">
        <div class="detail-car-desc-title">M√¥ t·∫£ chi ti·∫øt</div>
        <ul>
          <li>Nh·∫≠p: **{{ car.origin || 'Th√°i Lan' }}**</li>
          <!-- <li>Bi·ªÉn s·ªë (BS): **{{ car.plate || '63A - Tr·∫Øng' }}**</li> -->
          <li>M√†u: **{{ car.color || 'Cam' }}**</li>
          <li>S·ªë km: **{{ car.mileage | number }} KM** full l·ªãch s·ª≠ h√£ng</li>
          <li>Ph·ª• ki·ªán ƒëi k√®m: **DVD - cam 360\*, cam l√πi, d√°n phim, l√≥t s√†n, Tr·∫ßn 5D.**</li>
        </ul>
      </div>

      <div class="detail-car-tech-specs">
        <div class="detail-car-desc-title">Th√¥ng s·ªë k·ªπ thu·∫≠t</div>
        <div class="tech-specs-grid">
          <div class="spec-item">
            <span class="spec-label">Tr·ªçng l∆∞·ª£ng</span>
            <!-- <span class="spec-value">{{ car. || '-' }}</span> -->
          </div>
          <div class="spec-item">
            <span class="spec-label">C√¥ng su·∫•t (m√£ l·ª±c)</span>
            <span class="spec-value">{{ car.horsepower || '104 HP @ 6000 RPM' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">H·ªá d·∫´n ƒë·ªông</span>
            <span class="spec-value">{{ car.drivetrain || '4AT' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Dung t√≠ch (l√≠t)</span>
            <span class="spec-value">{{ car.engineCapacity || '1.5' }}</span>
          </div>

          <div class="spec-item">
            <span class="spec-label">ƒê·ªông c∆°</span>
            <span class="spec-value">{{ car.engineType || 'S·ªë t·ª± ƒë·ªông' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Ki·ªÉu d√°ng</span>
            <span class="spec-value">{{ car.bodyStyle || 'Minivan (MPV)' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Ti√™u th·ª• (l√≠t/100km)</span>
            <span class="spec-value">{{ car.fuelConsumption || '6.9' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">S·ªë t√∫i kh√≠</span>
            <span class="spec-value">{{ car.airbags || '2' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-car-policies">
        <div class="detail-car-desc-title">Ch√≠nh s√°ch ∆∞u ƒë√£i & n·ªïi b·∫≠t</div>
        <div class="policy-grid">
          <div class="policy-item">
            <span class="policy-icon">üè†</span>
            <span class="policy-text">Giao d·ªãch t·∫≠n n∆°i</span>
          </div>
          <div class="policy-item">
            <span class="policy-icon">üí∞</span>
            <span class="policy-text">Tr·∫£ g√≥p ∆∞u ƒë√£i</span>
          </div>
          <div class="policy-item">
            <span class="policy-icon">üõ°Ô∏è</span>
            <span class="policy-text">Ch√≠nh h√£ng 100%</span>
          </div>
        </div>
      </div>

      <div class="detail-car-loan-calculator">
        <div class="loan-calculator-title">T√≠nh kho·∫£n vay</div>

        <div class="loan-price">Gi√° xe (VND) <span>{{ car.price || 555000000 | number }}</span></div>

        <div class="loan-inputs-grid">
          <div class="loan-input-item dark-bg">
            <span class="input-label">Kho·∫£n vay (% gi√° xe)</span>
            <!-- <span class="input-value">{{ loanData.percentage || '50' }}</span> -->
          </div>
          <div class="loan-input-item dark-bg">
            <span class="input-label">Kho·∫£n vay (VND)</span>
            <!-- <span class="input-value">{{ loanData.amount || '277.500.000' | number }}</span> -->
          </div>
          <div class="loan-input-item dark-bg">
            <span class="input-label">L√£i su·∫•t (%)</span>
            <!-- <span class="input-value">{{ loanData.interest || '12' }}</span> -->
          </div>
          <div class="loan-input-item dark-bg">
            <span class="input-label">Th·ªùi gian vay (Th√°ng)</span>
            <!-- <span class="input-value">{{ loanData.duration || '60' }}</span> -->
          </div>
        </div>

        <div class="loan-result">
          <span class="result-label">S·ªë ti·ªÅn tr·∫£ g√≥p h√†ng th√°ng ∆∞·ªõc t√≠nh</span>
          <!-- <span class="result-value">{{ loanData.monthlyPayment || '6.172.834' | number }} VND / Th√°ng</span> -->
        </div>

        <div class="loan-deposit">
          <span class="deposit-label">Tr·∫£ tr∆∞·ªõc:</span>
          <!-- <span class="deposit-value">{{ loanData.deposit || '277.500.000' | number }} VND</span> -->
        </div>
      </div>

    </div>

    <div class="detail-car-right">
      <div class="detail-car-title">{{ car.model }} {{ car.year }} - {{ car.mileage | number }}KM
      </div>
      <div class="detail-car-price">
        <span class="price">{{ car.price | number }} ƒë</span>
        <span class="price-month">(Tr·∫£ g√≥p t·ª´ 5,0 tri·ªáu/th√°ng)</span>
      </div>
      <div class="detail-car-location">
        {{ car.location }}<br>
      </div>
      <div class="detail-car-specs">
        <div><b>Nhi√™n li·ªáu</b> <span>{{ car.fuelType }}</span></div>
        <div><b>Ki·ªÉu d√°ng</b> <span>{{ car.bodyStyle }}</span></div>
        <div><b>H·ªôp s·ªë</b> <span>{{ car.transmission }}</span></div>
        <div><b>S·ªë ch·ªó</b> <span>{{ car.seats }}</span></div>
      </div>

      <div class="detail-car-dealer" *ngIf="dealer">
        <img class="dealer-img" [src]="dealer.bannerUrl || 'https://via.placeholder.com/320x120?text=Dealer'"
          [alt]="dealer.storeName" />
        <div class="dealer-info">
          <div class="dealer-name">{{ dealer.storeName }} <span class="dealer-vip">üåª</span></div>
          <div class="dealer-location">{{ dealer.address }} <a class="dealer-link" href="#">Xem c·ª≠a h√†ng &gt;</a></div>
          <div class="dealer-stats">
            <span>ƒêang b√°n <b>{{ dealer.carsSelling || 20 | number }}</b></span>
            <span>ƒê√£ b√°n <b>{{ dealer.carsSold || 118 | number }}</b></span>
          </div>

          <div class="dealer-contact">
            <a class="dealer-phone-btn" href="tel:{{ dealer.phone || '0908000000' }}" target="_blank">
              <span class="dealer-phone-icon">üìû</span>
              <span class="dealer-phone-number">{{ dealer.phone || '0908.******' }}</span>
            </a>

            <a class="dealer-message-btn" href="https://zalo.me/{{ dealer.phone || '0932059379' }}" target="_blank">
              <span class="dealer-message-icon">üí¨</span>
              <span>Nh·∫Øn tin Zalo</span>
            </a>
          </div>
        </div>
      </div>

      <div class="dealer-other-cars">
        <div class="other-cars-title">Tin kh√°c c·ªßa {{ dealer.storeName || 'MITSUBISHI TR∆Ø·ªúNG CHINH' }}</div>
        <div class="other-cars-list">
          <div class="car-card" *ngFor="let otherCar of dealer.otherCars" (click)="goToDetail(otherCar.id)">
            <div class="car-card-header">
              <img [src]="otherCar.imageUrl || 'https://via.placeholder.com/200x120?text=Car'"
                alt="{{ otherCar.title }}">
              <span class="post-time">{{ otherCar.postedAgo || 'm·ªôt ng√†y tr∆∞·ªõc' }}</span>
            </div>
            <div class="car-card-body">
              <h4 class="car-title">{{ otherCar.title || 'Mitsubishi Attrage 2025' }}</h4>
              <p class="car-price">{{ otherCar.price || 380000000 | number }} ƒë</p>
              <p class="car-monthly-price">ch·ªâ t·ª´ {{ otherCar.monthlyPrice || 4.2 }} tri·ªáu/th√°ng</p>
            </div>
            <div class="car-card-footer">
              <span class="spec">5 ch·ªó</span>
              <span class="spec">S·ªë s√†n</span>
              <span class="spec">XƒÉng</span>
              <span class="spec">H·ªì Ch√≠ Minh</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Th√™m v√†o detail-car.component.html, trong ph·∫ßn .detail-car-right -->
      <div class="detail-car-booking">
        <button class="btn-book-appointment" (click)="openAppointmentModal()">
          <span class="booking-icon">üìÖ</span>
          ƒê·∫∑t l·ªãch xem xe
        </button>
      </div>

      <!-- Modal ƒë·∫∑t l·ªãch -->
      <div class="modal-overlay" *ngIf="isAppointmentModalOpen" (click)="closeAppointmentModal()">
        <div class="modal-content appointment-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>ƒê·∫∑t l·ªãch xem xe</h2>
            <button class="close-btn" (click)="closeAppointmentModal()">&times;</button>
          </div>

          <div class="modal-body">
            <div class="car-info" *ngIf="car">
              <img [src]="car.images?.[0]?.imageUrl || 'https://via.placeholder.com/100x60?text=Car'" [alt]="car.model">
              <div class="car-details">
                <h3>{{ car.model }} {{ car.year }}</h3>
                <p>Gi√°: {{ car.price | number }} ƒë</p>
              </div>
            </div>

            <form (ngSubmit)="bookAppointment()" #appointmentForm="ngForm">
              <div class="form-group">
                <label>Th√¥ng tin li√™n h·ªá</label>
                <div class="contact-info">
                  <input type="text" [(ngModel)]="appointmentData.customerName" name="customerName"
                    placeholder="H·ªç v√† t√™n" required>
                  <input type="tel" [(ngModel)]="appointmentData.customerPhone" name="customerPhone"
                    placeholder="S·ªë ƒëi·ªán tho·∫°i" required>
                  <input type="email" [(ngModel)]="appointmentData.customerEmail" name="customerEmail"
                    placeholder="Email" required>
                </div>
              </div>

              <div class="form-group">
                <label>Ch·ªçn ng√†y xem xe</label>
                <input type="date" [(ngModel)]="selectedDate" (change)="onDateChange()" name="appointmentDate"
                  [min]="minDate" required>
              </div>

              <div class="form-group">
                <label>Ch·ªçn khung gi·ªù</label>
                <div class="time-slots" *ngIf="availableSlots.length > 0">
                  <div *ngFor="let slot of availableSlots" class="time-slot" [class.available]="slot.isAvailable"
                    [class.selected]="selectedTime === slot.startTime" [class.unavailable]="!slot.isAvailable"
                    (click)="selectTimeSlot(slot)">
                    <span class="time">{{ formatTime(slot.startTime) }} - {{ formatTime(slot.endTime) }}</span>
                    <span class="status" *ngIf="!slot.isAvailable">ƒê√£ c√≥ l·ªãch</span>
                  </div>
                </div>
                <div *ngIf="availableSlots.length === 0 && selectedDate" class="no-slots">
                  Kh√¥ng c√≥ khung gi·ªù tr·ªëng cho ng√†y n√†y
                </div>
              </div>

              <div class="form-group">
                <label>Ghi ch√∫ (tu·ª≥ ch·ªçn)</label>
                <textarea [(ngModel)]="appointmentData.notes" name="notes"
                  placeholder="Ghi ch√∫ th√™m cho ƒë·∫°i l√Ω..."></textarea>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn-cancel" (click)="closeAppointmentModal()">H·ªßy</button>
                <button type="submit" class="btn-confirm" [disabled]="!selectedTime || !appointmentForm.form.valid">
                  X√°c nh·∫≠n ƒë·∫∑t l·ªãch
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>