<!-- dealer-appointments.component.html -->
<div class="appointments-container">
  <div class="header-section">
    <h1>ğŸ“… Quáº£n lÃ½ lá»‹ch háº¹n xem xe</h1>
    <p>Quáº£n lÃ½ vÃ  xá»­ lÃ½ cÃ¡c yÃªu cáº§u Ä‘áº·t lá»‹ch xem xe tá»« khÃ¡ch hÃ ng</p>
  </div>

  <!-- Statistics Cards -->
  <div class="statistics-grid">
    <div class="stat-card pending" (click)="filterByStatus(0)">
      <div class="stat-icon">â³</div>
      <div class="stat-info">
        <h3>{{ statistics.pending }}</h3>
        <p>Chá» xÃ¡c nháº­n</p>
      </div>
    </div>
    <div class="stat-card confirmed" (click)="filterByStatus(1)">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <h3>{{ statistics.confirmed }}</h3>
        <p>ÄÃ£ xÃ¡c nháº­n</p>
      </div>
    </div>
    <div class="stat-card completed" (click)="filterByStatus(2)">
      <div class="stat-icon">ğŸ‰</div>
      <div class="stat-info">
        <h3>{{ statistics.completed }}</h3>
        <p>HoÃ n thÃ nh</p>
      </div>
    </div>
    <div class="stat-card cancelled" (click)="filterByStatus(3)">
      <div class="stat-icon">âŒ</div>
      <div class="stat-info">
        <h3>{{ statistics.cancelled }}</h3>
        <p>ÄÃ£ há»§y</p>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <button class="filter-btn" [class.active]="filterMode === 'all'" (click)="filterByAll()">
      ğŸ“‹ Táº¥t cáº£
    </button>
    <div class="date-filter">
      <input type="date" [(ngModel)]="selectedDate" (change)="filterByDate()" placeholder="Lá»c theo ngÃ y">
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Äang táº£i...</p>
  </div>

  <!-- Appointments List -->
  <div class="appointments-list" *ngIf="!isLoading">
    <div *ngIf="filteredAppointments.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“­</div>
      <h3>KhÃ´ng cÃ³ lá»‹ch háº¹n nÃ o</h3>
      <p>ChÆ°a cÃ³ khÃ¡ch hÃ ng Ä‘áº·t lá»‹ch xem xe</p>
    </div>

    <div *ngFor="let appointment of filteredAppointments" class="appointment-card" [class]="getStatusInfo(appointment.status).class">
      <div class="appointment-header">
        <div class="car-info">
          <img [src]="appointment.carImageUrl || 'https://via.placeholder.com/80x60?text=Car'" alt="Car">
          <div>
            <h3>{{ appointment.carModel }} {{ appointment.carYear }}</h3>
            <p class="car-price">{{ appointment.carPrice | number }} Ä‘</p>
          </div>
        </div>
        <div class="status-badge" [class]="getStatusInfo(appointment.status).class">
          {{ getStatusInfo(appointment.status).icon }} {{ getStatusInfo(appointment.status).text }}
        </div>
      </div>

      <div class="appointment-body">
        <div class="info-grid">
          <div class="info-item">
            <span class="label">ğŸ‘¤ KhÃ¡ch hÃ ng:</span>
            <span class="value">{{ appointment.customerName }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</span>
            <span class="value">{{ appointment.customerPhone }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“§ Email:</span>
            <span class="value">{{ appointment.customerEmail }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ“… NgÃ y háº¹n:</span>
            <span class="value">{{ formatDate(appointment.appointmentDate) }}</span>
          </div>
          <div class="info-item">
            <span class="label">ğŸ• Giá» háº¹n:</span>
            <span class="value">{{ formatTime(appointment.appointmentTime) }}</span>
          </div>
          <div class="info-item">
            <span class="label">â±ï¸ Thá»i lÆ°á»£ng:</span>
            <span class="value">{{ appointment.durationMinutes }} phÃºt</span>
          </div>
        </div>

        <div class="notes" *ngIf="appointment.notes">
          <span class="label">ğŸ“ Ghi chÃº:</span>
          <p>{{ appointment.notes }}</p>
        </div>
      </div>

      <div class="appointment-footer">
        <button class="btn-detail" (click)="openDetailModal(appointment)">
          <i class="fas fa-info-circle"></i> Chi tiáº¿t
        </button>
        
        <div class="action-buttons">
          <button *ngIf="canConfirm(appointment)" class="btn-confirm" (click)="confirmAppointment(appointment)">
            <i class="fas fa-check"></i> XÃ¡c nháº­n
          </button>
          <button *ngIf="canComplete(appointment)" class="btn-complete" (click)="completeAppointment(appointment)">
            <i class="fas fa-check-circle"></i> HoÃ n thÃ nh
          </button>
          <button *ngIf="canReject(appointment)" class="btn-reject" (click)="openRejectModal(appointment)">
            <i class="fas fa-times"></i> Tá»« chá»‘i
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" *ngIf="isDetailModalOpen" (click)="closeDetailModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ğŸ“‹ Chi tiáº¿t lá»‹ch háº¹n</h2>
      <button class="close-btn" (click)="closeDetailModal()">&times;</button>
    </div>

    <div class="modal-body" *ngIf="selectedAppointment">
      <div class="detail-section">
        <h3>ğŸš— ThÃ´ng tin xe</h3>
        <div class="car-detail">
          <img [src]="selectedAppointment.carImageUrl || 'https://via.placeholder.com/150x100?text=Car'" alt="Car">
          <div>
            <p><strong>Máº«u xe:</strong> {{ selectedAppointment.carModel }} {{ selectedAppointment.carYear }}</p>
            <p><strong>GiÃ¡:</strong> {{ selectedAppointment.carPrice | number }} Ä‘</p>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h3>ğŸ‘¤ ThÃ´ng tin khÃ¡ch hÃ ng</h3>
        <p><strong>Há» tÃªn:</strong> {{ selectedAppointment.customerName }}</p>
        <p><strong>Sá»‘ Ä‘iá»‡n thoáº¡i:</strong> {{ selectedAppointment.customerPhone }}</p>
        <p><strong>Email:</strong> {{ selectedAppointment.customerEmail }}</p>
      </div>

      <div class="detail-section">
        <h3>ğŸ“… ThÃ´ng tin lá»‹ch háº¹n</h3>
        <p><strong>NgÃ y:</strong> {{ formatDate(selectedAppointment?.appointmentDate ?? []) }}</p>
        <p><strong>Giá»:</strong> {{ formatTime(selectedAppointment?.appointmentTime ?? []) }}</p>
        <p><strong>Thá»i lÆ°á»£ng:</strong> {{ selectedAppointment.durationMinutes }} phÃºt</p>
        <p><strong>Tráº¡ng thÃ¡i:</strong> 
          <span class="status-badge" [class]="getStatusInfo(selectedAppointment.status).class">
            {{ getStatusInfo(selectedAppointment.status).icon }} {{ getStatusInfo(selectedAppointment.status).text }}
          </span>
        </p>
      </div>

      <div class="detail-section" *ngIf="selectedAppointment.notes">
        <h3>ğŸ“ Ghi chÃº</h3>
        <p>{{ selectedAppointment.notes }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-close" (click)="closeDetailModal()">ÄÃ³ng</button>
    </div>
  </div>
</div>

<!-- Reject Modal -->
<div class="modal-overlay" *ngIf="isRejectModalOpen" (click)="closeRejectModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>âŒ Tá»« chá»‘i lá»‹ch háº¹n</h2>
      <button class="close-btn" (click)="closeRejectModal()">&times;</button>
    </div>

    <div class="modal-body">
      <p>Báº¡n cÃ³ cháº¯c muá»‘n tá»« chá»‘i lá»‹ch háº¹n vá»›i <strong>{{ selectedAppointment?.customerName }}</strong>?</p>
      
      <div class="form-group">
        <label>LÃ½ do tá»« chá»‘i (tÃ¹y chá»n):</label>
        <textarea [(ngModel)]="rejectReason" placeholder="Nháº­p lÃ½ do tá»« chá»‘i..."></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeRejectModal()">Há»§y</button>
      <button class="btn-confirm-reject" (click)="rejectAppointment()">XÃ¡c nháº­n tá»« chá»‘i</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast-notification" *ngIf="showToast" [class]="toastType">
  <span>{{ toastMessage }}</span>
  <button class="toast-close" (click)="hideToast()">&times;</button>
</div>