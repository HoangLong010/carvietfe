<!-- schedule-management.component.html -->
<div class="schedule-management-container">
  <div class="header-section">
    <h1>ğŸ¯ Quáº£n lÃ½ lá»‹ch lÃ m viá»‡c</h1>
    <p>Thiáº¿t láº­p lá»‹ch lÃ m viá»‡c cá»§a cá»­a hÃ ng Ä‘á»ƒ khÃ¡ch hÃ ng Ä‘áº·t lá»‹ch xem xe. Báº¡n cÃ³ thá»ƒ chá»‰nh sá»­a tá»«ng ngÃ y hoáº·c cáº­p nháº­t táº¥t cáº£ cÃ¹ng lÃºc.</p>
    <button class="btn-create-new" (click)="openBatchEditModal()">
      <i class="fas fa-edit"></i> ğŸ“… Chá»‰nh sá»­a táº¥t cáº£ lá»‹ch
    </button>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Äang táº£i lá»‹ch lÃ m viá»‡c...</p>
  </div>

  <!-- Schedule cards -->
  <div class="schedules-grid" *ngIf="!isLoading">
    <div *ngFor="let day of daysOfWeek" class="schedule-card" 
         [class.inactive]="!hasSchedule(day.id) || !getScheduleByDay(day.id)?.isActive">
      
      <!-- Náº¿u chÆ°a cÃ³ lá»‹ch cho ngÃ y nÃ y -->
      <div *ngIf="!hasSchedule(day.id)">
        <div class="schedule-header">
          <h3>{{ day.name }}</h3>
          <span class="status-badge">â° ChÆ°a thiáº¿t láº­p</span>
        </div>
        <div class="schedule-body" style="text-align: center; padding: 30px 0;">
          <p style="color: #7f8c8d; margin-bottom: 20px;">ChÆ°a cÃ³ lá»‹ch lÃ m viá»‡c cho ngÃ y nÃ y</p>
          <button class="btn-add-schedule" (click)="openAddScheduleModal(day.id)">
            <i class="fas fa-plus"></i> ThÃªm lá»‹ch
          </button>
        </div>
      </div>

      <!-- Náº¿u Ä‘Ã£ cÃ³ lá»‹ch -->
      <div *ngIf="hasSchedule(day.id)">
        <div class="schedule-header">
          <h3>{{ getScheduleByDay(day.id)?.dayName }}</h3>
          <span class="status-badge" [class.active]="getScheduleByDay(day.id)?.isActive">
            {{ getScheduleByDay(day.id)?.isActive ? 'âœ… Äang hoáº¡t Ä‘á»™ng' : 'â›” Ngá»«ng hoáº¡t Ä‘á»™ng' }}
          </span>
        </div>
        <div class="schedule-body">
          <div class="time-range">
            <i class="fas fa-clock"></i>
            {{ formatTime(getScheduleByDay(day.id)?.startTime || '') }} - 
            {{ formatTime(getScheduleByDay(day.id)?.endTime || '') }}
          </div>
          <div class="slot-duration">
            <i class="fas fa-hourglass-half"></i>
            Thá»i gian má»—i khung: {{ getScheduleByDay(day.id)?.slotDuration }} phÃºt
          </div>
          <div class="schedule-actions">
            <button class="btn-edit-small" (click)="openEditScheduleModal(getScheduleByDay(day.id)!)">
              <i class="fas fa-edit"></i> Sá»­a
            </button>
            <button class="btn-delete-small" (click)="deleteSchedule(getScheduleByDay(day.id)!)">
              <i class="fas fa-trash"></i> XÃ³a
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal chá»‰nh sá»­a Ä‘Æ¡n láº» -->
<div class="modal-overlay" *ngIf="isEditModalOpen && !isBatchMode" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ currentEditSchedule?.id ? 'âœï¸ Chá»‰nh sá»­a' : 'â• ThÃªm' }} lá»‹ch lÃ m viá»‡c - {{ currentEditSchedule?.dayName }}</h2>
      <button type="button" class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="saveSingleSchedule()" #singleForm="ngForm">
        <div class="form-group">
          <label>ğŸ• Giá» báº¯t Ä‘áº§u</label>
          <input type="time" [(ngModel)]="currentEditSchedule!.startTime" 
                 name="startTime" required>
        </div>

        <div class="form-group" style="margin-top: 20px;">
          <label>ğŸ•” Giá» káº¿t thÃºc</label>
          <input type="time" [(ngModel)]="currentEditSchedule!.endTime" 
                 name="endTime" required>
        </div>

        <div class="form-group" style="margin-top: 20px;">
          <label>â±ï¸ Thá»i gian má»—i khung (phÃºt)</label>
          <input type="number" [(ngModel)]="currentEditSchedule!.slotDuration" 
                 name="slotDuration" min="15" max="120" required>
        </div>

        <div class="checkbox-group" style="margin-top: 20px;">
          <label>
            <input type="checkbox" [(ngModel)]="currentEditSchedule!.isActive" 
                   name="isActive">
            ğŸŸ¢ Hoáº¡t Ä‘á»™ng
          </label>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeEditModal()">âŒ Há»§y</button>
          <button type="submit" class="btn-confirm" [disabled]="!singleForm.form.valid || isLoading">
            {{ isLoading ? 'â³ Äang lÆ°u...' : 'ğŸ’¾ LÆ°u' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal chá»‰nh sá»­a hÃ ng loáº¡t -->
<div class="modal-overlay" *ngIf="isEditModalOpen && isBatchMode" (click)="closeEditModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ğŸ“… Chá»‰nh sá»­a táº¥t cáº£ lá»‹ch lÃ m viá»‡c</h2>
      <button type="button" class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="saveBatchSchedules()" #batchForm="ngForm">
        <div *ngFor="let schedule of editSchedules; let i = index" class="schedule-edit-item">
          <h3>{{ schedule.dayName }}</h3>
          <div class="form-row">
            <div class="form-group">
              <label>ğŸ• Giá» báº¯t Ä‘áº§u</label>
              <input type="time" [(ngModel)]="schedule.startTime" 
                     [name]="'startTime' + i" required>
            </div>
            <div class="form-group">
              <label>ğŸ•” Giá» káº¿t thÃºc</label>
              <input type="time" [(ngModel)]="schedule.endTime" 
                     [name]="'endTime' + i" required>
            </div>
            <div class="form-group">
              <label>â±ï¸ Thá»i gian má»—i khung (phÃºt)</label>
              <input type="number" [(ngModel)]="schedule.slotDuration" 
                     [name]="'slotDuration' + i" min="15" max="120" required>
            </div>
            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" [(ngModel)]="schedule.isActive" 
                       [name]="'isActive' + i">
                ğŸŸ¢ Hoáº¡t Ä‘á»™ng
              </label>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeEditModal()">âŒ Há»§y</button>
          <button type="submit" class="btn-confirm" 
                  [disabled]="!batchForm.form.valid || isLoading">
            {{ isLoading ? 'â³ Äang lÆ°u...' : 'ğŸ’¾ LÆ°u táº¥t cáº£' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast-notification" *ngIf="showToast" [class]="toastType">
  <span>{{ toastMessage }}</span>
  <button class="toast-close" (click)="hideToast()">&times;</button>
</div>